

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>ROS MiniImu Calibration and Sensor Fusion - HOME</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="HOME">
<meta property="og:title" content="ROS MiniImu Calibration and Sensor Fusion">








  

  









  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "g3rald",
      "url" : null,
      "sameAs" : null
    }
  </script>






<!-- end SEO -->

<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="HOME Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<meta http-equiv="cleartype" content="on">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="/">HOME</a></li>
          
            
            <li class="masthead__menu-item"><a href="/components/">Components</a></li>
          
            
            <li class="masthead__menu-item"><a href="/about/">ABOUT ROBOCUP-RESCUE</a></li>
          
            
            <li class="masthead__menu-item"><a href="/team/">TEAM</a></li>
          
            
            <li class="masthead__menu-item"><a href="/credits/">WEBSITE CREDITS</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      


<nav class="nav__list">
  
  <ul>
    
      <li>
        
          
          

          <a href="/components/"><span class="nav__sub-title">Components</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/components/ros-on-nuc/" class="">Ros on Intel-NUC</a></li>
          
            
            

            
            

            <li><a href="/components/imu/" class="">IMU</a></li>
          
            
            

            
            

            <li><a href="/components/motor-controller/" class="">Motor-Controller</a></li>
          
            
            

            
            

            <li><a href="/components/spotlight/" class="">Spotlight</a></li>
          
            
            

            
            

            <li><a href="/components/buck-converter/" class="">Buck-Converter</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>



    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="ROS MiniImu Calibration and Sensor Fusion">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">ROS MiniImu Calibration and Sensor Fusion
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <h2 id="overview">Overview</h2>
<p>This is a <a href="http://www.ros.org">ROS</a> package developed to calibrate and fuse the orientation data provided by an Polulu MiniImu v9.</p>

<p>The ROS MiniImu Calibration and Sensor Fusion Packages are tested under ROS Indigo and Ubuntu 14.04.</p>

<p><strong>Affiliation: Advancements for Robotics in Rescue Applications, AR2A</strong></p>

<p>##Travis Build Status
<a href="https://travis-ci.org/AR2A/imu-minimu-arduino"><img src="https://travis-ci.org/AR2A/imu-minimu-arduino.svg?branch=master" alt="Build Status" /></a></p>

<h2 id="installation">Installation</h2>

<h3 id="dependencies">Dependencies</h3>

<p>This software is built on the Robotic Operating System (<a href="http://www.ros.org">ROS</a>), which needs to be <a href="http://wiki.ros.org">installed</a> first. Additionaly, the ROS MiniImu Calibration and Sensor Fusion depends on following software:</p>

<ul>
  <li>
    <p><a href="https://www.arduino.cc">arduino toolchain</a> (simple programming environment for education pcbs)</p>
  </li>
  <li>
    <p><a href="https://github.com/ros-drivers/rosserial">rosserial</a> (wrapper to transmit ros messages over a serial port)</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  sudo apt-get install ros-indigo-rosserial-arduino
  sudo apt-get install ros-indigo-rosserial
</code></pre>
    </div>
  </li>
  <li>
    <p><a href="http://www.boost.org">Boost</a> (general purpose c++ library),</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  sudo apt-get install libboost-dev
</code></pre>
    </div>
  </li>
  <li>
    <p><a href="http://arma.sourceforge.net/">armadillo</a> (c++ linear algebra library),</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  sudo apt-get install liblapack-dev
  sudo apt-get install libblas-dev
  sudo apt-get install libarmadillo-dev
</code></pre>
    </div>
  </li>
</ul>

<h3 id="building">Building</h3>

<p>To use the packages in your project, clone the latest version of this repository to the source folder of your catkin workspace.
Make sure that all dependencies listed above are installed before executing catkin_make.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    cd ~/catkin_ws/src
    git clone https://github.com/AR2A/imu-minimu-arduino.git
    cd ..
    catkin_make
</code></pre>
</div>

<h2 id="basic-usage">Basic Usage</h2>

<h3 id="downloading-the-firmware-to-the-arduino">Downloading the firmware to the arduino</h3>

<p>In order for the download to work modify the file “avr_imu/firmware/CMakeLists.txt” to suit your setup.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    cmake_minimum_required(VERSION 2.8.3)
    
    include_directories(ros_lib arduino_libs)
    
    generate_arduino_firmware(avr_imu
    	SRCS avr_imu.cpp arduino_libs/L3G/L3G.cpp arduino_libs/LSM303/LSM303.cpp ros_lib/time.cpp
    	BOARD mega2560
    	PORT /dev/ttyACM0
    )
</code></pre>
</div>

<p>Most likely the variables BOARD and PORT have to be modified.</p>

<p>Afterwards you download the firmware by issuing the following commands inside your catkin workspace.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    catkin_make avr_imu_firmware_avr_imu
    catkin_make avr_imu_firmware_avr_imu-upload
</code></pre>
</div>

<h3 id="visualizing-data-with-rviz">Visualizing data with <a href="http://wiki.ros.org/rviz">rviz</a></h3>

<p>For debugging purposes it can be useful to visualize the orientation within <a href="http://wiki.ros.org/rviz">rviz</a>. To do so install the imu_tools package which contains the <a href="http://wiki.ros.org/rviz_imu_plugin">rviz_imu_plugin</a> package.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    sudo apt-get install ros-indigo-imu-tools
</code></pre>
</div>

<h2 id="nodes">Nodes</h2>

<h3 id="node-avrimu">Node: avr_imu</h3>

<p>This is the rosserial node running on the arduino board. The node reads the data from the imu over the spi interface and issues a message containing this data in a 50 Hz cycle.</p>

<h4 id="subscribed-topics">Subscribed Topics</h4>

<p><em>None</em></p>

<h4 id="published-topics">Published Topics</h4>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/data_raw</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>)</p>

    <p>The raw register data of the imu (accelerometer and gyroscope).</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/magnetic_field</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/MagneticField.html">sensor_msgs/MagneticField</a>)</p>

    <p>The raw register data of the imu (magnetometer).</p>
  </li>
</ul>

<h4 id="services">Services</h4>

<p><em>None</em></p>

<h4 id="parameters">Parameters</h4>

<p><em>None</em></p>

<h3 id="node-calibimuexperimental">Node: calib_imu(experimental)</h3>

<p>This node executes a step by step calibration process to compensate the alignement and scaling of the imu data (as well as hard and soft ironing effects on the magnetometer data). When the calibration finishes the calculated data is stored inside the ros execution path (typical ~/.ros).</p>

<h4 id="subscribed-topics-1">Subscribed Topics</h4>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/data_raw</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>)</p>

    <p>The raw register data of the imu (accelerometer and gyroscope).</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/magnetic_field</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/MagneticField.html">sensor_msgs/MagneticField</a>)</p>

    <p>The raw register data of the imu (magnetometer).</p>
  </li>
</ul>

<h4 id="published-topics-1">Published Topics</h4>

<p><em>None</em></p>

<h4 id="services-1">Services</h4>

<p><em>None</em></p>

<h4 id="parameters-1">Parameters</h4>

<p><em>None</em></p>

<h3 id="node-processimudata">Node: process_imu_data</h3>

<p>This node processes the senor fusion with an extended kalman filter</p>

<p>The node is roughly designed after the findings of the following paper:</p>

<blockquote>
  <p>David Jurman, Marko Jankovec, Roman Kamnik, Marko Topic, “<a href="http://www.sciencedirect.com/science/article/pii/S0924424707003834">Calibration and data fusion solution for the miniature
attitude and heading reference system</a>”, in Sensors and Actuators A: Physical, Volume 138, 2007.</p>
</blockquote>

<h4 id="subscribed-topics-2">Subscribed Topics</h4>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/data_raw</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>)</p>

    <p>The raw register data of the imu (accelerometer and gyroscope).</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/magnetic_field</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/MagneticField.html">sensor_msgs/MagneticField</a>)</p>

    <p>The raw register data of the imu (magnetometer).</p>
  </li>
</ul>

<h4 id="published-topics-2">Published Topics</h4>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">/imu/data</code></strong> (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>)</p>

    <p>The fused orientation data.</p>
  </li>
</ul>

<h4 id="services-2">Services</h4>

<p><em>None</em></p>

<h4 id="parameters-2">Parameters</h4>

<p><em>None</em></p>

<h2 id="bugs--feature-requests">Bugs &amp; Feature Requests</h2>

<p>Please report bugs and request features using the <a href="https://github.com/AR2A/imu-minimu-arduino/issues">Issue Tracker</a>.</p>


        
      </section>

      <footer class="page__meta">
        
        




        
      </footer>

      

      


    </div>

    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
    
    <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 g3rald. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




    <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

  </body>
</html>

